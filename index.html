<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINAPSIS | Estrategia y Seguridad</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --bg: #05070a; --panel: #0d1117; --accent: #58a6ff; --alert: #f0883e; --text: #c9d1d9; --font-serif: 'Libre Baskerville', serif; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        header { background: #000; padding: 40px; text-align: center; border-bottom: 2px solid #30363d; position: relative; }
        .brand { font-family: var(--font-serif); font-size: 3em; letter-spacing: 5px; color: var(--accent); margin: 0; }
        
        /* Simposio */
        .simposium { max-width: 1200px; margin: 40px auto; padding: 40px; border: 1px solid var(--alert); display: grid; grid-template-columns: 1fr 1fr; gap: 40px; background: #000; }
        .reg-form { display: flex; flex-direction: column; gap: 10px; }
        .reg-form input { padding: 12px; background: #111; border: 1px solid #333; color: #fff; }
        
        /* Cards */
        .grid { max-width: 1200px; margin: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 30px; padding: 20px; }
        .card { background: var(--panel); border: 1px solid #333; cursor: pointer; transition: 0.3s; position: relative; height: 450px; overflow: hidden; display: flex; flex-direction: column; justify-content: flex-end; }
        .card:hover { border-color: var(--accent); transform: translateY(-5px); }
        .card-img { position: absolute; top:0; left:0; width:100%; height:100%; opacity: 0.4; z-index:1; background-size: cover !important; }
        .card-body { position: relative; z-index: 2; padding: 25px; background: linear-gradient(transparent, #000 80%); }
        .auth-badge { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--accent); }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; }
        .modal-content { background: var(--bg); width: 90%; max-width: 1100px; margin: 2vh auto; padding: 50px; height: 90vh; overflow-y: auto; border: 1px solid #333; }
        .bloque { display: grid; grid-template-columns: 1fr 80px; gap: 30px; margin-bottom: 25px; }
        .texto { line-height: 1.8; font-size: 1.1em; text-align: justify; }
        .btn-g { background: #111; border: 1px solid #333; color: #888; padding: 8px; cursor: pointer; margin-bottom: 5px; }
    </style>
</head>
<body>

<header>
    <div onclick="accesoBunker()" style="position:absolute; right:20px; top:20px; color:#222; cursor:pointer;"><i class="fas fa-lock"></i></div>
    <h1 class="brand">SINAPSIS</h1>
    <p style="color:var(--alert); font-weight:bold; letter-spacing:2px;">INTELIGENCIA Y ESTRATEGIA</p>
</header>

<section class="simposium">
    <div>
        <h2 style="color:var(--alert); font-family:var(--font-serif);">SIMPOSIO 2025</h2>
        <p>Inscr√≠base para acceder al capital de conocimiento de la red Sinapsis.</p>
        <p><strong>Fecha:</strong> 28 Oct | <strong>Hora:</strong> 19:00</p>
    </div>
    <div class="reg-form" id="area-reg">
        <input type="text" id="rn" placeholder="Nombre Completo">
        <input type="email" id="re" placeholder="Correo Institucional">
        <input type="text" id="ri" placeholder="Organismo / Entidad">
        <button onclick="registrarSimposio()" style="padding:12px; background:var(--alert); border:none; font-weight:bold; cursor:pointer;">INSCRIBIRSE</button>
    </div>
</section>

<div class="grid" id="grid-articulos"></div>

<div id="modalArticulo" class="modal">
    <div class="modal-content">
        <span onclick="cerrar()" style="float:right; cursor:pointer; color:var(--alert); font-weight:bold;">CERRAR</span>
        <div id="cont"></div>
    </div>
</div>

<script>
    const SB_URL = 'https://wajivhbldplztjvqudht.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indhaml2aGJsZHBsenRqdnF1ZGh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MzkxNjQsImV4cCI6MjA4MzMxNTE2NH0.NyDC18RuIZGoH_Epnt1oCgMMxDMBhfoK-wdEKHU0rYk';
    const _supabase = supabase.createClient(SB_URL, SB_KEY);

    let localArt = [];

    async function cargar() {
        const { data } = await _supabase.from('articulos').select('*').order('id', { ascending: false });
        if (data) { localArt = data; dibujar(data); }
    }

    function dibujar(lista) {
        document.getElementById('grid-articulos').innerHTML = lista.map((a, i) => `
            <div class="card" onclick="abrir(${i})">
                <div class="card-img" style="background:url('${a.Imagen_URL}') center/cover;"></div>
                <div class="card-body">
                    <div class="auth-badge">
                        <img src="${a.Avatar_URL || 'https://via.placeholder.com/40'}" class="avatar">
                        <small style="color:var(--accent)">Investigador: ${a.Autor}</small>
                    </div>
                    <h3 style="margin:0; font-family:var(--font-serif);">${a.Titulo}</h3>
                </div>
            </div>
        `).join('');
    }

    function abrir(i) {
        const a = localArt[i];
        const doi = a.DOI || "10.555.sinapsis." + a.id;
        let pTotal = a.Contenido.split('\n').map((p, idx) => p.trim() ? `
            <div class="bloque">
                <div class="texto">${p}</div>
                <div style="display:flex; flex-direction:column;">
                    <button class="btn-g" onclick="reaccionar(${a.id},${idx},'üí°')">üí°</button>
                    <button class="btn-g" onclick="reaccionar(${a.id},${idx},'‚ùì')">‚ùì</button>
                </div>
            </div>` : "").join('');

        const buzon = `
            <div style="background:var(--panel); padding:30px; border:1px solid var(--accent); margin-top:40px;">
                <h3 style="color:var(--accent); margin-top:0;">Canal de Di√°logo con el Investigador</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;">
                    <input type="text" id="m-n" placeholder="Su Nombre" style="padding:10px; background:#000; border:1px solid #333; color:#fff;">
                    <input type="email" id="m-e" placeholder="Su Correo" style="padding:10px; background:#000; border:1px solid #333; color:#fff;">
                </div>
                <textarea id="m-t" placeholder="Propuesta o tesis..." style="width:100%; height:100px; background:#000; color:#fff; border:1px solid #333; padding:10px;"></textarea>
                <button onclick="enviar(${i})" style="width:100%; padding:15px; background:var(--alert); border:none; margin-top:10px; font-weight:bold; cursor:pointer;">REGISTRAR Y ENVIAR</button>
            </div>
        `;

        document.getElementById('cont').innerHTML = `<h1>${a.Titulo}</h1><p><small>DOI: ${doi}</small></p><hr>${pTotal}${buzon}`;
        document.getElementById('modalArticulo').style.display = 'block';
    }

    async function enviar(i) {
        const a = localArt[i];
        const n = document.getElementById('m-n').value;
        const e = document.getElementById('m-e').value;
        const t = document.getElementById('m-t').value;
        if(!n || !e || !t) return alert("Complete los datos.");

        const { error } = await _supabase.from('sinapsis_reacciones').insert([{ 
            art√≠culo_id: a.id, tipo_reaccion: 'üí¨', 
            comentario_texto: `AUTOR: ${n} (${e}) | MSG: ${t}` 
        }]);

        if(!error) {
            const titSafe = a.Titulo.split(':')[0].substring(0,40);
            const link = a.contacto_link || "mailto:redaccion@sinapsis.com";
            const msg = encodeURIComponent(`Investigador ${a.Autor}, soy ${n} (${e}). Sobre "${titSafe}": ${t}`);
            window.location.href = link.includes('mailto') ? `${link}?subject=Sinapsis&body=${msg}` : `${link}?text=${msg}`;
            alert("Registrado en B√∫nker.");
        }
    }

    async function registrarSimposio() {
        const n = document.getElementById('rn').value;
        const e = document.getElementById('re').value;
        const i = document.getElementById('ri').value;
        const { error } = await _supabase.from('sinapsis_registros').insert([{ nombre:n, email:e, institucion:i }]);
        if(!error) document.getElementById('area-reg').innerHTML = "<h3>Inscripci√≥n Confirmada.</h3>";
    }

    async function reaccionar(id, p, t) {
        await _supabase.from('sinapsis_reacciones').insert([{ art√≠culo_id: id, parrafo_index: p, tipo_reaccion: t }]);
        alert("Se√±al registrada.");
    }

    function cerrar() { document.getElementById('modalArticulo').style.display='none'; }
    function accesoBunker() { if(prompt("CLAVE:")==="admin123") window.location.href="dashboard.html"; }
    cargar();
</script>
</body>
</html>
